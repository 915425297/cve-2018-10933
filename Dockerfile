# libssh server vulnerable to cve-2018-10933 with a simple PoC demo
FROM base/archlinux
ADD libssh-0.8.3.tar.xz /root
RUN pacman -Syu &&\
pacman -S net-tools vim python-paramiko openssh make gcc gdb cmake --noconfirm &&\
cp -r /root/libssh-0.8.3 /root/exploit-libssh-0.8.3 &&\
sed -i s/"#define SSH2_MSG_USERAUTH_REQUEST 50"/"#define SSH2_MSG_USERAUTH_REQUEST 52"/g /root/exploit-libssh-0.8.3/include/libssh/ssh2.h &&\
cd /root/libssh-0.8.3 &&\
mkdir build &&\
cd build &&\
cmake .. &&\
make &&\
make install &&\
cd examples &&\
make &&\
cd /root &&\
cd /root/exploit-libssh-0.8.3 &&\
mkdir build && \
cd build && \
cmake .. && \
make &&\
make install &&\
ssh-keygen -t dsa -f ssh_host_dsa_key -N '' &&\
ssh-keygen -t rsa -b 2048 -f ssh_host_rsa_key -N '' 
EXPOSE 22
CMD ["/root/libssh-0.8.3/build/examples/ssh_server_fork", "-d", "/root/ssh_host_dsa_key", "-k", "/root/ssh_host_rsa_key", "-p", "22", "-v", "0.0.0.0" ]
